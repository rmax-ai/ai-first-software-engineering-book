
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Technical book on AI-first software engineering governance and execution">
      
      
        <meta name="author" content="Autonomous Authors">
      
      
      
        <link rel="prev" href="../01-paradigm-shift/">
      
      
        <link rel="next" href="../03-autonomous-kernels/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>02. Harness Engineering - AI-First Software Engineering</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-02-harness-engineering" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="AI-First Software Engineering" class="md-header__button md-logo" aria-label="AI-First Software Engineering" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AI-First Software Engineering
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              02. Harness Engineering
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="AI-First Software Engineering" class="md-nav__button md-logo" aria-label="AI-First Software Engineering" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AI-First Software Engineering
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Preface
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Chapters
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Chapters
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-paradigm-shift/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01. Paradigm Shift
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    02. Harness Engineering
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    02. Harness Engineering
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#thesis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Thesis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-this-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Matters
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Breakdown
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concrete-example-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concrete Example 1
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concrete-example-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concrete Example 2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trade-offs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failure-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Failure Modes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#research-directions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Research Directions
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-autonomous-kernels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    03. Autonomous Kernels
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-memory-systems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    04. Memory Systems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-evaluation-and-traces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    05. Evaluation and Traces
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-agent-governance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    06. Agent Governance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-production-ai-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    07. Production AI Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../99-future-directions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    99. Future Directions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Patterns Overview
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Patterns Overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/harness-design-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Harness Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/memory-architectures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Architectures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/minimal-agent-loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Minimal Agent Loop
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/self-verification-loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Self-Verification Loop
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#thesis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Thesis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-this-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Matters
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Breakdown
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concrete-example-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concrete Example 1
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concrete-example-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concrete Example 2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trade-offs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failure-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Failure Modes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#research-directions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Research Directions
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="chapter-02-harness-engineering">Chapter 02 — Harness Engineering</h1>
<h2 id="thesis">Thesis</h2>
<p>Harness engineering is the discipline of turning a general-purpose model into a predictable system by defining tool contracts, constraints, loop control, and evaluation gates.</p>
<p>In this chapter, “predictable” means three things. First, the same input context tends to produce the same classes of actions (repeatability). Second, the system’s allowed changes are bounded by explicit constraints (boundedness). Third, outputs can be accepted or rejected by checks rather than judgment calls (verifiability).</p>
<p>Hypothesis (falsifiable): for a fixed set of tasks and repositories, tightening the harness (schemas, budgets, gates, and recovery rules) reduces regression rate and rework more than swapping between models of similar capability. Prompts and task definitions are held constant.</p>
<h2 id="why-this-matters">Why This Matters</h2>
<ul>
<li>The same model can behave reliably or unreliably depending on tool schemas, budgets, and verification.</li>
<li>Teams can standardize harness practices even when models change.</li>
<li>Production safety and auditability primarily live in the harness layer.</li>
</ul>
<h2 id="system-breakdown">System Breakdown</h2>
<ul>
<li><strong>Control plane</strong>: prompts, policies, budgets, stop conditions.</li>
<li><strong>Tool plane</strong>: filesystem edits, build/test runners, linters, browsers, APIs.</li>
<li><strong>Evaluation plane</strong>: checks as gates; regression suites; quality rubrics.</li>
<li><strong>State plane</strong>: task ledger, traces, decisions, artifacts.</li>
<li><strong>Interfaces</strong>:</li>
<li>Tool schemas and error contracts.</li>
<li>Patch discipline (diff-only, small changes).</li>
<li>Evaluation API (what constitutes pass/fail).</li>
</ul>
<p>A useful way to operationalize the planes is to name what each plane consumes, what it produces, and one metric you can track:</p>
<table>
<thead>
<tr>
<th>Plane</th>
<th>Responsibilities</th>
<th>Key artifacts (inputs/outputs)</th>
<th>One measurable metric</th>
</tr>
</thead>
<tbody>
<tr>
<td>Control plane</td>
<td>Decide what the agent is allowed to do and when to stop</td>
<td>Inputs: task brief, policy, iteration/time budget. Outputs: chosen strategy, stop reason</td>
<td>Iterations to first passing gate</td>
</tr>
<tr>
<td>Tool plane</td>
<td>Perform actions with bounded, typed interfaces</td>
<td>Inputs: tool calls with validated args. Outputs: patches, command outputs, structured errors</td>
<td>Patch locality (changed files/lines per task)</td>
</tr>
<tr>
<td>Evaluation plane</td>
<td>Decide if work is acceptable based on checks</td>
<td>Inputs: build/test/lint results, rubrics. Outputs: pass/fail + evidence</td>
<td>Gate pass rate (per iteration)</td>
</tr>
<tr>
<td>State plane</td>
<td>Record what happened and enable recovery</td>
<td>Inputs: events, diffs, tool outputs. Outputs: trace, ledger, artifacts for replay</td>
<td>Reproducibility rate (can rerun and get same pass/fail)</td>
</tr>
</tbody>
</table>
<p>The “minimal contract surface” is the set of interfaces that must be stable for predictability. It includes tool schemas (including error codes), patch discipline, and evaluation semantics.</p>
<h2 id="concrete-example-1">Concrete Example 1</h2>
<p>Design a tool contract for “apply patch” operations.</p>
<p>A minimal schema sketch:</p>
<ul>
<li>Required fields:</li>
<li><code>path</code>: absolute or repo-relative file path (must exist unless <code>create=true</code>)</li>
<li><code>old_str</code>: exact original text to be replaced (must match uniquely)</li>
<li><code>new_str</code>: replacement text</li>
<li><code>context</code>: optional surrounding lines to disambiguate</li>
<li>Constraints:</li>
<li>Reject edits that change unrelated whitespace outside the <code>old_str</code> region.</li>
<li>Reject edits that expand scope beyond the file (no implicit multi-file edits).</li>
<li>Reject edits that exceed a size budget (e.g., max changed lines per call).</li>
<li>Error contract (examples):</li>
<li><code>NOT_FOUND</code>: <code>path</code> does not exist and <code>create</code> is false</li>
<li><code>NON_UNIQUE_MATCH</code>: <code>old_str</code> matches multiple locations</li>
<li><code>NO_MATCH</code>: <code>old_str</code> matches zero locations (stale context)</li>
<li><code>BUDGET_EXCEEDED</code>: change size violates configured limits</li>
<li><code>POLICY_VIOLATION</code>: edit touches forbidden paths or patterns</li>
</ul>
<p>Happy path flow:
1. Agent proposes a patch using a unique <code>old_str</code> block with minimal scope.
2. Harness validates: file exists, match is unique, diff stays within budgets.
3. Tool applies the patch and returns a structured result: changed line counts, a before/after snippet, and a stable identifier for the diff.</p>
<p>Conflict recovery (when the patch fails with <code>NO_MATCH</code> or <code>NON_UNIQUE_MATCH</code>):
1. The harness returns the error code plus a short “fresh context” snippet around the closest match (or a list of candidate match ranges).
2. The agent re-reads the relevant portion of the file and regenerates a smaller, more specific <code>old_str</code> (or narrows by adding <code>context</code>).
3. If the second attempt fails, the harness forces a stop condition (“needs human review”) rather than allowing a whole-file overwrite.</p>
<p>Evaluation: measure whether the tool contract is improving outcomes with two task-level metrics:
- <strong>Revert rate</strong>: fraction of tasks where the patch is reverted in the next N commits/PR updates.
- <strong>Diff locality</strong>: median number of files touched and lines changed per task, with an alert threshold for outliers.</p>
<h2 id="concrete-example-2">Concrete Example 2</h2>
<p>Add an evaluation gate to an agent loop.</p>
<p>A minimal loop in prose looks like: attempt → gate → log → decide.
1. <strong>Attempt</strong>: the agent makes the smallest change it believes will satisfy the task.
2. <strong>Gate</strong>: the harness runs required checks (e.g., unit tests + static checks).
3. <strong>Log</strong>: record the tool outputs, the diff identifier, and the gate result in the task ledger.
4. <strong>Decide</strong>:
   - If gate passes: allow “PR-ready” output.
   - If gate fails: allow another iteration only if budgets remain and the failure is actionable.
   - If repeated failures occur: stop with a concrete failure summary and evidence.</p>
<p>Pass/fail criteria should be explicit:
- Pass = all configured checks return success (exit code 0) and no policy violations were triggered.
- Fail = any check fails, any policy violation occurs, or budgets are exceeded.</p>
<p>Fallback gate policy when tests are missing:
- If unit tests are absent or non-runnable, the harness should not silently accept “looks good.”
- Replace the unit-test requirement with a narrower, explicit fallback gate such as:
  - typecheck/lint/build must pass, and
  - a targeted command or script (documented in the repo) must run successfully, and
  - the change must be limited by stricter patch budgets (smaller allowed diffs).
- The harness should record which gate was used (<code>full_gate</code> vs <code>fallback_gate</code>) so reliability metrics stay comparable over time.</p>
<h2 id="trade-offs">Trade-offs</h2>
<ul>
<li>Richer tool schemas reduce ambiguity but raise integration cost.</li>
<li>Strict budgets prevent runaway loops but can truncate legitimate work.</li>
<li>Strong gates improve safety but may block progress on tasks lacking tests.</li>
</ul>
<p>Decision checklist (recommended defaults and when to relax):
- <strong>Tool schemas</strong>:
  - Default: prefer typed, validated arguments plus explicit error codes for recovery.
  - Relax when: prototyping a new tool where integration speed matters more than repeatability, but only in non-production contexts.
- <strong>Patch budgets</strong>:
  - Default: small, diff-only edits with per-call and per-task size limits.
  - Relax when: performing mechanical, reviewable migrations (e.g., dependency rename) where change breadth is intentional and measurable.
- <strong>Evaluation gates</strong>:
  - Default: require passing tests and static checks (a minimal green CI run) before any final output.
  - Relax when: the repo cannot run tests in the current environment; use an explicit fallback gate and tighten patch budgets rather than skipping evaluation.
- <strong>Stop conditions</strong>:
  - Default: stop on repeated failure modes (same check failing twice) with a structured report.
  - Relax when: failures are due to flaky infrastructure and you can rerun deterministically (record rerun count as part of the trace).</p>
<h2 id="failure-modes">Failure Modes</h2>
<ul>
<li><strong>Schema underspecification</strong>: tools accept ambiguous inputs, producing inconsistent outcomes.</li>
<li>How you notice: frequent <code>NO_MATCH</code>/<code>NON_UNIQUE_MATCH</code>-style failures, large diffs for small tasks, and high variance in outcomes across reruns.</li>
<li>Harness fix: tighten required fields, add validation (uniqueness checks, size budgets), and return structured error codes plus fresh context to guide recovery.</li>
<li><strong>Over-permissive harness</strong>: agents change broad parts of the repo with weak verification.</li>
<li>How you notice: many files touched per task, drift into unrelated directories, and regressions discovered after “completion.”</li>
<li>Harness fix: enforce patch locality budgets, add path allowlists/denylists, and require passing gates before accepting final output.</li>
<li><strong>Gate bypass</strong>: humans accept outputs without running checks, breaking the feedback loop.</li>
<li>How you notice: “merged without green checks,” missing logs/evidence in the ledger, and recurring regressions that gates would have caught.</li>
<li>Harness fix: make gates non-optional for PR-ready output (policy), require artifacts (logs, diff id, check results) attached to the task, and surface “stop reason” when evidence is missing.</li>
</ul>
<h2 id="research-directions">Research Directions</h2>
<ul>
<li>Harness quality metrics (iteration efficiency, regression rate, reproducibility).</li>
<li>Open question: which small set of metrics best predicts long-term reliability across repos?</li>
<li>Evaluation approach: track iterations to first passing gate, revert rate, and reproducibility rate using the plane metrics table, then compare distributions before/after harness changes.</li>
<li>Tool error taxonomies that guide automated recovery.</li>
<li>Open question: what error codes enable the highest “self-repair” rate without encouraging risky retries?</li>
<li>Evaluation approach: measure recovery success rate per error code (e.g., <code>% resolved within 2 retries</code>) and the resulting diff locality, using structured tool returns.</li>
<li>Portable harness templates across languages and repo types.</li>
<li>Open question: what parts of the contract surface are truly portable (schemas, budgets, gates) versus language-specific?</li>
<li>Evaluation approach: apply a template to multiple repos, then compare reproducibility rate and gate pass rate changes while holding model choice constant.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>