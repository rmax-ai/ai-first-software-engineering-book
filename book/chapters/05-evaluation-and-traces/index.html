
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Technical book on AI-first software engineering governance and execution" name="description"/>
<meta content="Autonomous Authors" name="author"/>
<link href="../04-memory-systems/" rel="prev"/>
<link href="../06-agent-governance/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.2" name="generator"/>
<title>05. Evaluation and Traces - AI-First Software Engineering</title>
<link href="../../../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#chapter-05-evaluation-and-traces">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="AI-First Software Engineering" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="AI-First Software Engineering">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            AI-First Software Engineering
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              05. Evaluation and Traces
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="AI-First Software Engineering" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="AI-First Software Engineering">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    AI-First Software Engineering
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    
  
    Home
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../preface/">
<span class="md-ellipsis">
    
  
    Preface
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Chapters
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Chapters
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../01-paradigm-shift/">
<span class="md-ellipsis">
    
  
    01. Paradigm Shift
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02-harness-engineering/">
<span class="md-ellipsis">
    
  
    02. Harness Engineering
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03-autonomous-kernels/">
<span class="md-ellipsis">
    
  
    03. Autonomous Kernels
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04-memory-systems/">
<span class="md-ellipsis">
    
  
    04. Memory Systems
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    05. Evaluation and Traces
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    05. Evaluation and Traces
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#thesis">
<span class="md-ellipsis">
      
        Thesis
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-this-matters">
<span class="md-ellipsis">
      
        Why This Matters
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#system-breakdown">
<span class="md-ellipsis">
      
        System Breakdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#concrete-example-1">
<span class="md-ellipsis">
      
        Concrete Example 1
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#concrete-example-2">
<span class="md-ellipsis">
      
        Concrete Example 2
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#trade-offs">
<span class="md-ellipsis">
      
        Trade-offs
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#failure-modes">
<span class="md-ellipsis">
      
        Failure Modes
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#research-directions">
<span class="md-ellipsis">
      
        Research Directions
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06-agent-governance/">
<span class="md-ellipsis">
    
  
    06. Agent Governance
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../07-production-ai-infrastructure/">
<span class="md-ellipsis">
    
  
    07. Production AI Infrastructure
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../99-future-directions/">
<span class="md-ellipsis">
    
  
    99. Future Directions
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../glossary/">
<span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Patterns Overview
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Patterns Overview
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/harness-design-patterns/">
<span class="md-ellipsis">
    
  
    Harness Design
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/memory-architectures/">
<span class="md-ellipsis">
    
  
    Memory Architectures
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/minimal-agent-loop/">
<span class="md-ellipsis">
    
  
    Minimal Agent Loop
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/self-verification-loop/">
<span class="md-ellipsis">
    
  
    Self-Verification Loop
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#thesis">
<span class="md-ellipsis">
      
        Thesis
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-this-matters">
<span class="md-ellipsis">
      
        Why This Matters
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#system-breakdown">
<span class="md-ellipsis">
      
        System Breakdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#concrete-example-1">
<span class="md-ellipsis">
      
        Concrete Example 1
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#concrete-example-2">
<span class="md-ellipsis">
      
        Concrete Example 2
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#trade-offs">
<span class="md-ellipsis">
      
        Trade-offs
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#failure-modes">
<span class="md-ellipsis">
      
        Failure Modes
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#research-directions">
<span class="md-ellipsis">
      
        Research Directions
      
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="chapter-05-evaluation-and-traces">Chapter 05 — Evaluation and Traces</h1>
<h2 id="thesis">Thesis</h2>
<p>Evaluation and traceability make AI-first engineering reproducible.
Traces provide evidence that links outcomes to the correct layer (model, tool, harness, or missing tests).
Evaluations turn that evidence into gates that prevent incorrect changes from being accepted.</p>
<p>Hypothesis: without trace-first design, teams cannot reliably distinguish a model error (wrong edit suggestion) from a tool error (command failed).
They also cannot distinguish harness errors (applied the wrong diff or wrong working directory) from missing tests (a real regression that was not checked).</p>
<h2 id="why-this-matters">Why This Matters</h2>
<ul>
<li>Reproducibility is a prerequisite for iterative improvement.</li>
<li>Evaluation gates define the autonomy envelope and prevent silent regressions.</li>
<li>Traces enable post-incident analysis and systematic harness refinement.</li>
</ul>
<h2 id="system-breakdown">System Breakdown</h2>
<ul>
<li><strong>Trace schema</strong> (minimum viable):</li>
<li>task id</li>
<li>plan<ul>
<li>intended steps</li>
<li>stop conditions</li>
</ul>
</li>
<li>tool calls<ul>
<li>tool name</li>
<li>arguments</li>
<li>start/end timestamps</li>
<li>exit status</li>
</ul>
</li>
<li>tool outputs<ul>
<li>stdout/stderr excerpts, or pointers to stored artifacts</li>
</ul>
</li>
<li>diffs<ul>
<li>patches applied</li>
<li>file paths touched</li>
</ul>
</li>
<li>evaluation results<ul>
<li>which checks ran</li>
<li>pass/fail</li>
<li>key failure signatures</li>
</ul>
</li>
<li>budgets<ul>
<li>time</li>
<li>iteration count</li>
<li>token/cost limits (if applicable)</li>
</ul>
</li>
<li>stop reason<ul>
<li>completed</li>
<li>blocked by gate</li>
<li>permission denied</li>
<li>budget exceeded</li>
</ul>
</li>
<li>redaction policy<ul>
<li>what is removed or hashed (secrets, tokens, PII, proprietary paths)</li>
</ul>
</li>
<li>environment fingerprint<ul>
<li>repo URL (if applicable)</li>
<li>commit SHA</li>
<li>branch</li>
<li>tool versions</li>
<li>OS/arch</li>
</ul>
</li>
<li>retry/iteration counters<ul>
<li>attempt number per step</li>
<li>total loop count</li>
</ul>
</li>
<li>Query examples (incident review):<ul>
<li>“show all tasks that modified <code>pyproject.toml</code> and failed secret scanning”</li>
<li>“list failures where <code>tests</code> failed but a patch was still applied”</li>
<li>“group stop reasons by action class over the last N runs”</li>
</ul>
</li>
<li><strong>Evaluation types</strong>:</li>
<li>correctness: unit/integration/contract tests.</li>
<li>safety: permission checks, protected paths, secret scanning.</li>
<li>quality: lint, type checks, formatting, doc checks.</li>
<li>performance: benchmarks, latency/cost budgets.</li>
<li><strong>Gating model</strong>: which evaluations are required for which action classes.</li>
</ul>
<p>A gating model is only useful if the trace explains the choice.
  A reviewer should be able to see why a gate passed, failed, or was skipped.</p>
<p>A diagram helps here because the logic is a decision flow.
  Focus on the first safety decision and the first failing gate.</p>
<div class="mermaid">flowchart TB
  A[Action class selected] --&gt; B[Safety gate(s)\n(permission / protected-path / secret scan)]
  B --&gt;|fail| S1[STOP\nstop_reason set\nrecord: failure_signature + touched_paths]
  B --&gt;|pass| C[Required evaluations\nquality + correctness + performance]
  C --&gt; D{Any required eval missing?}
  D --&gt;|yes| S2[STOP\nstop_reason set\nrecord: skipped_reason + selection_reason]
  D --&gt;|no| E{Any eval failed?}
  E --&gt;|yes| S3[STOP\nstop_reason set\nrecord: command + exit_status + failure_signature]
  E --&gt;|no| F[CONTINUE / COMPLETE\nrecord: evaluation_results + budgets\nstop_reason=completed]
</div>
<p>After you review the flow, the key takeaway is this: every STOP is a first-class outcome.
  The trace must record enough to explain the stop and replay the same checks.</p>
<p>Legend:</p>
<ul>
<li>Diamonds are harness decision points.</li>
<li>
<p>Every STOP must record enough fields to replay the same checks.</p>
</li>
<li>
<p>Minimal gating matrix (example, stated as rules):</p>
</li>
<li>
<p>read-only (grep/view/list):</p>
<ul>
<li>safety: require permission check for accessed path(s)</li>
<li>quality: skip; record <code>skipped_reason: "read_only_action"</code></li>
<li>correctness: skip; record <code>skipped_reason: "read_only_action"</code></li>
<li>performance: skip; record <code>skipped_reason: "read_only_action"</code></li>
</ul>
</li>
<li>
<p>patch edit (apply diff to code/docs):</p>
<ul>
<li>safety:</li>
<li>require protected-path check for all touched files</li>
<li>if any touched file is protected:<ul>
<li>stop with <code>stop_reason: "permission_denied"</code></li>
</ul>
</li>
<li>quality:</li>
<li>require lint/typecheck if repo has config</li>
<li>otherwise record <code>skipped_reason: "no_config"</code></li>
<li>correctness:</li>
<li>require targeted tests for touched modules</li>
<li>selection order:
      1) if a module→test mapping exists:
         - run the mapped command
         - record <code>selection_reason: "mapping"</code>
      2) else if the plan declares <code>test_command</code>:
         - run it
         - record <code>selection_reason: "plan.test_command"</code>
      3) else if the repo declares a default test command:
         - run it
         - record <code>selection_reason</code> with the source path
      4) else if a stack can be detected:
         - run the stack fallback command
         - record <code>selection_reason: "fallback.detected_stack"</code>
      5) else:
         - record <code>skipped_reason: "no_test_runner_detected"</code>
         - stop with <code>stop_reason: "blocked_by_correctness_gate"</code></li>
<li>fallback by detected stack:</li>
<li>Deterministic stack detection (precedence order):<ul>
<li>Inputs:</li>
<li>touched file paths from the diff (after patch application)</li>
<li>repo evidence files (repo root only)</li>
<li>Step 1 — candidates from touched paths:</li>
<li>Python if any touched path ends with <code>.py</code></li>
<li>Node if any touched path ends with <code>.js</code>, <code>.jsx</code>, <code>.ts</code>, or <code>.tsx</code></li>
<li>Go if any touched path ends with <code>.go</code></li>
<li>Step 2 — if no candidates, use evidence files:</li>
<li>Python if <code>pyproject.toml</code>, <code>pytest.ini</code>, <code>setup.cfg</code>, or <code>requirements.txt</code> exists</li>
<li>Node if <code>package.json</code> exists</li>
<li>Go if <code>go.mod</code> exists</li>
<li>Step 3 — tie-break precedence:</li>
<li>Python → Node → Go</li>
<li>Trace requirements:</li>
<li>record <code>selection_reason</code> (example: <code>touched_ext:.py</code>)</li>
<li>record <code>detected_stacks</code> before tie-break (example: <code>[python,node]</code>)</li>
</ul>
</li>
<li>Python: <code>pytest -q</code></li>
<li>Node: <code>npm test</code></li>
<li>Go: <code>go test ./...</code></li>
<li>performance:</li>
<li>require only when applicable</li>
<li>require if any touched path is under <code>deploy/</code></li>
<li>require if any touched path is under <code>prod/</code></li>
<li>require if the plan declares <code>latency_budget_ms</code> or <code>cost_budget_usd</code></li>
<li>otherwise record <code>skipped_reason: "not_applicable"</code></li>
</ul>
</li>
<li>
<p>dependency install (lockfile changes, package adds):</p>
<ul>
<li>safety:</li>
<li>require secret scan of the diff and updated lockfile(s)</li>
<li>record scan tool name</li>
<li>record any hit signatures</li>
<li>safety:</li>
<li>require protected-path check for touched files</li>
<li>if blocked, stop with <code>stop_reason: "permission_denied"</code></li>
<li>quality:</li>
<li>require lint/typecheck if repo has config</li>
<li>otherwise record <code>skipped_reason: "no_config"</code></li>
<li>correctness:</li>
<li>require tests that import the changed dependency</li>
<li>if unknown, select a command using the patch-edit rule</li>
<li>record <code>selection_reason</code> for the path taken</li>
<li>performance:</li>
<li>require only when runtime or deploy files change</li>
<li>examples: <code>Dockerfile</code>, <code>deploy/**</code></li>
<li>otherwise record <code>skipped_reason: "not_applicable"</code></li>
</ul>
</li>
<li>
<p>deploy/release (publish, migrate, prod config):</p>
<ul>
<li>safety:</li>
<li>require explicit permission grant</li>
<li>record grant artifact (id or prompt) in the trace</li>
<li>safety:</li>
<li>require secret scan</li>
<li>stop on any forbidden hit</li>
<li>record hit signatures</li>
<li>quality:</li>
<li>require lint/typecheck if configured</li>
<li>otherwise record <code>skipped_reason: "no_config"</code></li>
<li>correctness:</li>
<li>require full suite or contract tests for release</li>
<li>record suite name and command</li>
<li>performance:</li>
<li>require if a budget is declared in the plan</li>
<li>stop if exceeded</li>
<li>record measured values</li>
</ul>
</li>
</ul>
<h2 id="concrete-example-1">Concrete Example 1</h2>
<p>Tracing a refactor.</p>
<ul>
<li>Record each patch, each test run, and each failure signature.</li>
<li>Also record the environment fingerprint and exact tool invocations.</li>
<li>That combination lets a reviewer replay the same sequence.</li>
</ul>
<p>Pseudo-trace excerpt (illustrative):</p>
<pre><code class="language-yaml">    task_id: refactor-auth-2026-02-22-001

    environment:
      repo_sha: a1b2c3d
      tool_versions:
        pytest: 8.1.1
        python: 3.12.1

    plan:
      - rename AuthClient -&gt; CopilotClient
      - update imports
      - run targeted tests
      - stop if tests fail

    tool_calls:
      - tool: apply_patch
        files:
          - src/auth/client.py
        exit_status: 0
      - tool: bash
        cmd: pytest -q tests/test_auth_client.py::test_retry
        exit_status: 1
        failure_signature: ImportError: cannot import name 'AuthClient'

    diffs:
      - path: src/auth/client.py
        summary: renamed symbol
      - path: tests/test_auth_client.py
        summary: unchanged

    evaluation_results:
      correctness:
        cmd: pytest -q tests/test_auth_client.py::test_retry
        outcome: FAIL
        signature: ImportError

    stop_reason: blocked_by_correctness_gate
</code></pre>
<p>Query step using structured fields (one possible workflow):</p>
<ul>
<li>Query: <code>repo_sha == "a1b2c3d" AND failure_signature CONTAINS "ImportError: cannot import name 'AuthClient'" AND diffs.paths CONTAINS "src/auth/client.py"</code></li>
<li>Result (summary):</li>
<li>matching_tasks: 3</li>
<li>last_success_task_id: <code>refactor-auth-2026-02-20-007</code></li>
<li>last_success_repo_sha: <code>a1b2c3d</code></li>
<li>common_missing_patch_pattern: diffs do not include any files under <code>src/auth/__init__.py</code> or <code>src/auth/*</code> besides <code>client.py</code></li>
</ul>
<p>Decision rule using the query result:</p>
<ul>
<li>If <code>last_success_repo_sha</code> matches the current <code>repo_sha</code>:</li>
<li>If only <code>client.py</code> was changed, expand patch scope to import sites.</li>
<li>Update <code>src/auth/__init__.py</code> exports and import usages.</li>
<li>Rerun <code>pytest -q tests/test_auth_client.py::test_retry</code>.</li>
<li>If <code>last_success_repo_sha</code> differs:</li>
<li>Rebase/reset to the pinned <code>repo_sha</code> first.</li>
<li>Apply the expanded patch.</li>
<li>Rerun <code>pytest -q tests/test_auth_client.py::test_retry</code>.</li>
</ul>
<p>Attribution using the trace:</p>
<ul>
<li>Model vs tool is not ambiguous here.</li>
<li>The patch tool succeeded, and the test runner executed.</li>
<li>The failure signature is a stable ImportError.</li>
<li>The diffs show a narrow touch pattern, so the likely cause is refactor incompleteness.</li>
</ul>
<h2 id="concrete-example-2">Concrete Example 2</h2>
<p>Drift detection for an agent loop.</p>
<ul>
<li>Maintain a stable eval suite and a small set of “golden” tasks.</li>
<li>A “golden task” should include:</li>
<li>fixed input prompt and any fixed attachments</li>
<li>fixed repo state (commit SHA) or a pinned fixture repository</li>
<li>expected outcome constraints (e.g., “touch only <code>src/foo.py</code>”, “no network”, “no new dependencies”)</li>
<li>expected evaluations (which checks must pass)</li>
<li>budgets (max iterations, max wall time, max tool calls)</li>
<li>Define a baseline run-set for each golden task.</li>
<li>Example: “last green run-set on release tag <code>vX.Y</code>”.</li>
<li>
<p>Keep repo_sha and harness version pinned for the baseline.</p>
</li>
<li>
<p>Detect changes in iteration counts, regression rate, and stop reasons over time.</p>
</li>
<li>iteration drift:<ul>
<li>median loop iterations in the most recent 50 runs increases by ≥ 30%</li>
<li>compare against the baseline’s 50-run median</li>
</ul>
</li>
<li>regression rate:<ul>
<li>correctness-gate failure rate in the most recent 50 runs increases by ≥ 5 percentage points</li>
<li>compare against the baseline’s 50-run rate</li>
</ul>
</li>
<li>stop-reason shift:<ul>
<li>in the most recent 50 runs, “budget exceeded” becomes the most frequent stop_reason</li>
<li>baseline window had “completed” as the most frequent stop_reason</li>
</ul>
</li>
</ul>
<p>The point is not to predict every future failure. The point is to detect that something changed (model, tool, harness, or repo) and to have enough trace evidence to localize the change.</p>
<h2 id="trade-offs">Trade-offs</h2>
<ul>
<li>More evaluation increases confidence but costs time and compute.</li>
<li>Rich traces help debugging but create storage and privacy burdens.</li>
<li>Overly rigid gates can block progress on codebases with weak test coverage.</li>
</ul>
<h2 id="failure-modes">Failure Modes</h2>
<ul>
<li><strong>Eval gaming</strong>: optimizing for metrics while harming real-world quality.</li>
<li>Detect: compare “passes gates” with downstream signals in traces (reverts, follow-up bugfix tasks, repeated failures on adjacent golden tasks); watch for large diffs with minimal test coverage.</li>
<li>Respond: add adversarial or regression tests, strengthen gate definitions (e.g., require touched-module tests), and record coverage/selection rationale in the trace.</li>
<li><strong>Blind spots</strong>: evaluations do not cover critical behaviors.</li>
<li>Detect: incidents where traces show “all gates passed” but production-like behavior fails; repeated similar failures without corresponding eval signatures.</li>
<li>Respond: add contract tests or invariants to the eval suite; introduce risk-based gating (e.g., stricter checks for auth/payment paths) and make the gating decision explicit in the trace.</li>
<li><strong>Un-actionable traces</strong>: logs exist but lack structure, making search and attribution hard.</li>
<li>Detect: inability to answer basic questions (“what changed?”, “what ran?”, “why did it stop?”) without reading raw logs; missing environment fingerprint or missing diff records.</li>
<li>Respond: enforce a minimal trace schema, store normalized fields for queries, and treat “missing trace fields” as an evaluation failure for non-trivial action classes.</li>
</ul>
<h2 id="research-directions">Research Directions</h2>
<ul>
<li>Standard trace formats for portability across tools and models.</li>
<li>Risk-based gating (stricter checks for higher-risk diffs).</li>
<li>Low-cost evaluations that correlate with production outcomes.</li>
</ul>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>